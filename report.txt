This code receives two main pieces of information from the Arduino MIDI breakout board's MIDI IN jack: (1) MIDI time code and (2) MIDI note on.

MIDI time code:

http://en.wikipedia.org/wiki/MIDI_timecode

We have it set up so that MIDI sends us 

We built the unit so that it 


MNDR
====

The Rainbroz met MNDR at Webster Hall in February where we set up the Rainbow Machine for the MTV O Music Awards. MNDR sings and plays upbeat elecro-pop. She uses music-reactive visuals as part of her live performance.

MNDR works with light artist Jamie Carreiro as her lighting producer. Jamie is a programmer who uses a projector to overlay custom graphics over the entire stage. His projections use MIDI input to synchronize its patterns with the music. He controls effects live using an iPad, for instance to place a spotlight on MNDR as she moves about the stage.

For her North American tour starting in March with the Ting Tings, MNDR was not able to bring Jamie with her. So the Rainbroz and MNDR sat down to see if we could create a music-reactive light show for her to take on the road. We agreed to take the project and created a self-contained, hands-off, robust unit that powered 72 RGB LEDs that lined MNDR's transparent gear case.

[[image of the box]]

Hardware
========

MNDR uses Ableton Live as her master sequencer with preprogrammed melodies and drum tracks which send audio out to the venue's sound board, a bass track that sends MIDI out to a Moog Voyager synth, and a custom MIDI track she uses to send to Jamie for live visuals. She uses MIDI controllers like the Novation Ableton Launchpad to progress through her set and to customize the live performance for each show.

For her tour with the Ting Tings, MNDR fabricated a 30" x 20" x 7" box of bullet proof glass dubbed the Activity Center. The Activity Center housed all of the gear she needed to play, except for her synth and MIDI controller keyboard, and would be placed on a stand onstage.

[[image of Activity Center]]

We lined the edges of the Activity Center with RGB LED strips and created a lighting controller we call the Rainbow Brain housed within a small bamboo box that lives in the Activity Center. The Rainbow Brain has a MIDI input and power input, and outputs signals to the RGB LED strip and a couple of AC relays for additional effects.

Inside the Rainbow Brain is simply an Arduino Uno and a Sparkfun MIDI breakout board. One of the requirements of the LED lightshow was to keep the component costs down, so we put the entire music-reactive (MIDI-reactive) logic of the LEDs onto the Arduino. No computer was required to directly control the Arduino.

[does this belong in this section?] While we programmed the Rainbow Brain to work with MNDR's set without any direct control, we also exposed functionality to allow MNDR to control the lights with simple button pushes. One of her MIDI triggers flashed the LEDs a bright white, and two other triggers toggled the two relays on and off.

Lighting design
===============

The box was programmed in context of MNDR's music. 

Design constraints: the unit would be audio-reactive to MNDR's music, and it would be follow the set arc of the MNDR's live show.

Set
Song
Scene = verse/chorus/bridge
Effects

There are three simple effects that make up each scene. The effects are chasers (i.e., the "Nightrider effect"), pulsing, and solid. These are combined together to make a scene.

These effects make sense conceptually on a single LED or on a line of LEDs. But what becomes interesting is sequencing the 7 lines of the box with these effects. For instance, pulsing each line sequentially to highlight each box edge individually [GIF], or alternating the pulsing between the horizontal lines and the vertical lines [GIF], or, my favorite, pulsing each of the three outlined faces (left, front, right) [GIF].

Different pulse speeds and how often they are triggered are also considered to match the different song styles. Ballads are better suited to slow fades, and upbeat songs go along with short staccato flashes on the downbeats.

For the chasers, the busiest sequencing option is to start a chaser from each corner on the downbeat. This effect works great with the harsh electronic effects of Sparrow.



Software
========

-- extra midi track on the Ableton side for us

We agreed upon a set of MIDI messages to control the light show. In particular, the MIDI track she sends to the Arduino consists of MIDI program change messages indicating the start of a new song, the BPM of the current song through MIDI timecode messages, and notes at the beginning of each chorus, verse, bridge, etc., that we use to change the lighting effects palette. That information was enough for us to design a fully customized lighting show that reacts precisely to her set.

and a MIDI track that sends out to lighting Arduino microcontroller that controls the LEDs



Use cases
=========

The most effective use of our lighting is when it is subtle. For instance, I am most proud of how the box accompanies MNDR on her track "Feed Me Diamonds". A ballad, MNDR steps in front of the box and appeals to her audience on a personal level. Behind her, the box glows a static purple. During a bridge in the song, it remains purple-pink but gently pulses brighter on each downbeat, giving a visual drive to the track. As she builds to the closing climax, chasers appear overtop the solid purple-pink to emphasize her appeal.

At one key point in her set, MNDR transitions from "Caligula" to "C.L.U.B." as a DJ would beat match two records at a party. The transition consists of a few loop stages and requires MNDR to manually advance the Ableton Live sequencer to the next loop stage until C.L.U.B begins in earnest. Within the loop stage, MNDR switches settings and tweaks knobs to have a nice electro improvisational breakdown that the crowd goes crazy for. With each new song element that is introduced via new loop stages, the box knowingly adds in extra chasers in concert with MNDR's large hand gestures, signifying a key change in the sound made by the electronic performer.

It is exciting to coordinate our efforts in the future to have a heavy stellar audio-visual show.

-- coordinating with Jamie in the future

Traditional lighting rigs
=============

Lighting rigs at venues are very powerful! And adaptable. Lighting producers at music venues must each night use their pre-programmed effects libraries to provide visual support to each song. Each day lighting producers listen to performers they hadn't heard prior to sound check and make notes about the how the set breaks down. They ready their lighting board to react to the performance, and during the performance they run their pre-programmed routines.

Lighting rigs are kludgy, they are not designed to each artist and are generally not reactive to the music. If a lighting producer decides to pulse the lights, they must tap out the rhythm of the tracks during the set. Watching this happen at Webster Hall, this is a very crude method.

But lighting rigs scale well. An average audience member doesn't know any better and he or she is there to watch the performers rather than the lights. If an expensive tour rolls into the venue, they provide their own lighting producer that learns the system and provides a cohesive show using the existing infrastructure.

The box was designed in context of MNDR's music. She uses Ableton Live with preprogrammed melodies and drum tracks which send out to the venue's sound board, a bass track that sends MIDI out to a live Moog Voyager synth rack unit, and a MIDI track that sends out to lighting Arduino microcontroller that controls the LEDs. She uses MIDI controllers like the Novation Ableton Launchpad controller to progress through her set and to customize the live performance for each show.

The MIDI track she sends to the Arduino consists of MIDI program change messages indicating the start of a new song, the BPM of the current song through MIDI timecode messages, and notes at the beginning of each chorus, verse, bridge, etc., that we use to change the lighting effects palette. That information was enough for us to design a fully customized lighting show that reacts precisely to her set.

Watching the lighting rig at Webster Hall with the box we created was confusing. On one hand, the lighting producer was doing his or her job to bombard the stage with light in a semi-coherent fashion. On the other hand, our unit was precisely linked to MNDR's set. The wattage of the lighting rig overpowered the box, and the box performed best during the ballads with the lighting rig was static. 



- two circuit problem


Thanks
======

-- mndr is cool!

Emmett Harley for working on the Ableton side of MNDR's set

Peter Wade

